# A股/期货全方位分析与回测框架 (Vest)

这是一个基于 Python 的综合性金融分析工具，集成了数据获取、基本面分析、技术面分析、财务报表解读以及量化回测功能。项目位于 `vest` 目录下。

## 📁 项目结构

主要脚本及其功能说明：

- **`stock_analysis_v2.py`** (核心)
    - **功能**: 项目的主入口程序。
    - **主要职责**:
        - 协调数据获取、分析和报告生成。
        - **增量分析**: 分析营收、净利润的季度/年度趋势，判断增长质量和预期。
        - **公司分析**: 评估基本面（成长性、护城河）、财务风险、分红能力和估值水平。
        - **财报解读**: 深度解读最新财报，分析现金流结构和资产负债状况。
        - **量化回测**: 使用 `backtrader` 框架运行技术指标策略（如双均线交叉），评估历史表现。
        - **期货分析**: 支持商品期货的趋势分析（包含 `FuturesAnalyzer` 类）。
    - **输出**: 生成包含图表和 Markdown 格式的详细分析报告。

- **`data_fetcher.py`**
    - **功能**: 数据获取模块。
    - **特点**: 使用多线程并发从 `akshare` 等数据源获取财务数据、K线数据、分红记录、北向资金流向等。包含数据清洗和标准化逻辑。

- **`analysis.py`**
    - **功能**: 核心计算库。
    - **职责**: 提供各类财务指标（单季度数据拆分、TTM计算）和技术指标（RSI, MACD, KDJ, 均线斜率）的计算函数。

- **`config.py`**
    - **功能**: 配置文件。
    - **内容**: 定义了模型参数（DCF, DDM, EVA）、绘图样式（字体、颜色）、并发设置以及行业对标配置。

- **`test_fix.py`**
    - **功能**: 测试脚本。
    - **用途**: 用于验证特定的修复或功能是否正常（例如验证 `analyze_growth_momentum` 函数的修复）。

- **`delete_file.py`** & **`inspect_akshare.py`**
    - **功能**: 辅助工具脚本，用于清理文件或检查 `akshare` 库的 API 变动。

## 🚀 快速开始

### 环境准备

确保已安装必要的 Python 库（参考 `vest/requirements.txt`）：

```bash
pip install akshare backtrader pandas numpy matplotlib seaborn
```

### 运行分析

进入 `vest` 目录：

```bash
cd vest
```

运行主程序进行分析（支持股票代码或期货名称）：

```bash
# 分析某只股票 (例如: 002683)
python stock_analysis_v2.py 002683

# 分析某只股票 (例如: 贵州茅台) - 需代码支持中文映射或自行输入代码
python stock_analysis_v2.py 600519

# 分析期货品种 (例如: 黄金)
python stock_analysis_v2.py 黄金
```

如果不带参数运行，程序会提示输入代码。

## 📊 功能亮点

1.  **多维度的增量分析**: 不仅仅看绝对值，更关注季度同比/环比的变化趋势，捕捉业绩加速或反转信号。
2.  **全面的风险预警**: 自动扫描“存贷双高”、非经常性损益占比过高、现金流恶化等潜在雷区。
3.  **智能估值系统**: 结合 PE(TTM)、PB、PEG 以及历史分位点，给出低估/合理的判断，并计算 PEG 匹配度。
4.  **自动化回测**: 内置经典交易策略回测，直观展示策略在标的上的历史收益和回撤情况。
5.  **精美的可视化**: 自动生成营收利润走势图、增量信号仪表盘、技术分析图表等。

## 📝 产出物

运行结束后，程序会在当前目录下创建一个名为 `分析报告_<代码>_<时间戳>` 的文件夹，其中包含：
- 各类分析图表 (`.png`)
- 综合分析报告 (`report.md`)
