<div align="center">

# 📈 Analysis Pro 全维投资分析框架 v3.0

**基于 Python 的综合金融分析工具 (股票/期货)**  
覆盖数据获取 → 基本面/库存/基差分析 → 财报解读 → 量化回测 → 自动报告生成

![Python](https://img.shields.io/badge/Python-3.9+-blue.svg)
![akshare](https://img.shields.io/badge/Data-akshare-green.svg)
![backtrader](https://img.shields.io/badge/Backtest-backtrader-orange.svg)

</div>

---

## 🗂️ 项目结构

```
├── stock_analysis/                  # 核心分析模块
│   ├── stock_analysis_v2.py         # 主程序入口（统一支持 A股 + 期货）
│   ├── data_fetcher.py              # 多线程数据抓取与清洗
│   ├── analysis.py                  # 财务/技术指标计算库
│   ├── industry_compare.py          # 行业横向对比模块
│   ├── config.py                    # 模型参数与样式配置
│   └── requirements.txt             # Python 依赖
│
└── akshare+backtrader回测框架/       # 独立回测策略示例 (Backtrader)
    ├── Single Moving Average.py     # 单均线策略
    ├── Double Moving Average.py     # 双均线金叉/死叉策略
    └── Three moving averages.py     # 三均线交互策略
```

---

## ✨ 功能亮点

### 🅰️ A股深度分析 (Stock)

| 模块 | 核心功能 | 关键问题 |
|------|----------|----------|
| **🚀 增量分析** | 单季度拆分、TTM 序列、同比/环比趋势 | 业绩增量是否有预期？ |
| **🏢 公司分析** | 成长性、竞争力、财务安全、分红能力 | 公司质地如何？ |
| **📑 财报解读** | 业绩表现、现金流健康度、资产负债结构 | 财报有何风险信号？ |
| **🏭 行业对比** | 杜邦分析对比、行业排位、雷达图 | 在行业中处于什么位置？ |
| **🤖 量化回测** | 双均线交叉策略、夏普比率、最大回撤 | 策略历史表现如何？ |

### 🚀 期货全维分析 (Futures)

| 维度 | 分析内容 | 核心价值 |
|------|----------|----------|
| **📈 趋势分析** | 主连K线(3年)、MA均线系统、MACD/RSI/ATR | 识别当前趋势与波动率 |
| **📦 库存分析** | 交易所仓单变化、季节性库存水位 | 供需关系的核心指标 |
| **📊 基差分析** | 期现价差 (Basis)、期限结构 | 判断期现套利机会 |
| **💰 席位持仓** | 前20名主力多空持仓对比、净持仓变化 | 聪明钱的流向 |
| **🎯 综合评分** | 基于趋势、动量、持仓的多维打分 (0-100) | 快速判断多空方向 |

#### 支持的期货品种

**金属类**: 黄金(AU)、白银(AG)、铜(CU)、铝(AL)、锌(ZN)、铅(PB)、镍(NI)、锡(SN)、不锈钢(SS)

**能源化工**: 原油(SC)、燃料油(FU)、沥青(BU)、PTA(TA)、甲醇(MA)、乙二醇(EG)、橡胶(RU)、纸浆(SP)、尿素(UR)、纯碱(SA)

**黑色系**: 螺纹钢(RB)、热卷(HC)、铁矿石(I)、焦炭(J)、焦煤(JM)、动力煤(ZC)、硅铁(SF)、锰硅(SM)

**农产品**: 豆粕(M)、豆油(Y)、棕榈油(P)、菜粕(RM)、菜油(OI)、玉米(C)、淀粉(CS)、鸡蛋(JD)、生猪(LH)、白糖(SR)、棉花(CF)、苹果(AP)、红枣(CJ)

> 💡 **提示**: 输入中文名称或代码均可，系统会自动识别和映射

---

## 🚀 快速开始

### 1. 环境准备

```bash
# 进入分析目录
cd stock_analysis

# 安装核心依赖
pip install -r requirements.txt
```

### 2. 统一运行入口

**只需一个脚本，自动识别股票或期货代码：**

```bash
# 股票模式 (输入6位代码)
python stock_analysis_v2.py 600519    # 贵州茅台
python stock_analysis_v2.py 000858    # 五粮液

# 期货模式 (输入中文名称或代码)
python stock_analysis_v2.py 螺纹钢    # 自动识别为 RB
python stock_analysis_v2.py 黄金      # 自动识别为 AU
python stock_analysis_v2.py RB        # 直接输入代码
python stock_analysis_v2.py M         # 豆粕

# 交互模式 (不带参数)
python stock_analysis_v2.py
# 按提示输入: "茅台" 或 "纯碱"
```

### 3. 独立回测示例

```bash
cd akshare+backtrader回测框架
python "Double Moving Average.py"    # 运行策略
```

---

## 🔗 工作流程

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  数据获取   │ -> │  数据处理   │ -> │  分析引擎   │ -> │  报告输出   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                  │                  │                  │
  data_fetcher       analysis.py      stock_analysis_v2      输出目录
  • 财务三表        • 单季度拆分       • 增量分析           • *.png 图表
  • K线/分红        • TTM 计算         • 公司分析           • report.md
  • 北向资金        • 技术指标         • 财报解读
  • 股东结构                           • 量化回测
```

---

## ⚙️ 配置说明

编辑 `stock_analysis/config.py` 可自定义：

```python
# 估值模型参数
DCF_CONFIG = {
    'DISCOUNT_RATE': 0.10,      # 折现率 (WACC)
    'TERMINAL_GROWTH': 0.03,    # 永续增长率
}

DDM_CONFIG = {
    'REQUIRED_RETURN': 0.10,    # 要求回报率
}

EVA_CONFIG = {
    'WACC': 0.08                # 加权平均资本成本
}

# 数据获取
MAX_WORKERS = 8                 # 并发线程数
KLINE_YEARS = 10                # K线数据年限

# 可视化
FONT_FAMILY = 'Arial Unicode MS'  # macOS 字体（Windows 改为 SimHei）
```

---

## 📝 输出报告详解

运行后在当前目录生成 `分析报告_{股票代码}_{日期时间}/` 文件夹，包含：

### 📁 报告文件结构

#### 🅰️ 股票模式报告
```
分析报告_600519_20260107_1648/
│
├── 📊 增量分析
│   └── 0_增量分析.png              # 单季度业绩拆分与同比/环比信号
│
├── 📈 滚动趋势分析 (00-08)
│   ├── 00_营收利润滚动.png         # TTM营收与净利润走势
│   ├── 01_营收现金流滚动.png       # 经营现金流 vs 营收匹配度
│   ├── 02_现金流结构滚动.png       # 三大现金流结构变化
│   ├── 03_市值营收滚动.png         # PS估值与市值走势
│   ├── 05_研发投入滚动.png         # 研发费用占比趋势
│   ├── 06_利润率结构.png           # 毛利率/净利率/费用率拆解
│   ├── 07_EVA与FCF.png             # 经济增加值与自由现金流
│   └── 08_营运资本结构.png         # 应收/存货/应付占比
│
├── 💹 估值与技术分析 (04, 10, 21)
│   ├── 04_估值分析.png             # PE/PB/PS 综合估值
│   ├── 10_技术指标.png             # K线 + MA均线 + MACD + RSI + KDJ
│   └── 21_历史估值通道.png         # 历史PE/PB分位数通道
│
├── 🔬 深度财务分析 (09, 14-18)
│   ├── 09_ROE杜邦分析.png          # 净利率×周转率×杠杆 分解
│   ├── 14_股息率走势.png           # 历史分红与股息率
│   ├── 15_财务费用走势.png         # 利息支出与财务费用率
│   ├── 16_销售费用走势.png         # 销售费用占比趋势
│   └── 18_财务状况一览.png         # 资产负债表/利润表/现金流核心指标
│
├── 💰 估值模型 (11-13)
│   ├── 11_DCF估值.png              # 现金流折现模型 (支持负现金流)
│   ├── 12_DDM估值.png              # 股利折现模型 (需有分红历史)
│   └── 13_EVA估值.png              # 经济增加值模型
│
├── 🏭 行业对标 (20, 22)
│   ├── 20_运营效率分析.png         # 周转率/现金周期对比
│   └── 22_行业对标分析.png         # 自动匹配同行业TOP4雷达图
│
├── 📊 Dashboard 仪表盘 (D1-D3)
│   ├── D1_基本面Dashboard.png      # 成长/盈利/安全 6维雷达
│   ├── D2_估值Dashboard.png        # PE/PB/PS 综合评分
│   └── D3_费用Dashboard.png        # 三费占比仪表盘
│
├── 🤖 量化回测
│   └── 99_回测结果.png             # SMA双均线策略收益曲线
│
└── 📄 数据文件
    └── analysis_data.json          # 原始分析数据 (可二次加工)
```

#### 🚀 期货模式报告
```
分析报告_RB_20260108_1200/
│
├── 📈 期货报告_RB_20260108.png     # 综合分析一张图 (高清大图)
│   ├── 子图1: 价格趋势与指标 (MA60 + MACD + RSI)
│   ├── 子图2: 波动率锥 (ATR历史分位)
│   ├── 子图3: 库存年化趋势 (主要交易所仓单季节性)
│   ├── 子图4: 期限结构 (主力 vs 远月价差 Basis)
│   └── 子图5: 多空持仓对比 (前20名主力席位净持仓)
│
├── 📄 分析报告.txt                 # 自动生成的文字解读
└── 📄 analysis_data.json           # 包含所有原始数据的JSON
```

### 📋 图表内容速查表

| 编号 | 图表名称 | 核心内容 | 适用场景 |
|:----:|----------|----------|----------|
| **0** | 增量分析 | 单季度营收/净利润、同比/环比增速 | 业绩拐点判断 |
| **00** | 营收利润滚动 | TTM营收、净利润趋势 | 长期成长性 |
| **01** | 营收现金流滚动 | 经营现金流/营收比值 | 盈利质量验证 |
| **02** | 现金流结构滚动 | 经营/投资/筹资现金流 | 资金流向分析 |
| **03** | 市值营收滚动 | PS估值、市值走势 | 估值泡沫识别 |
| **04** | 估值分析 | PE/PB/PS 多维估值 | 综合估值判断 |
| **05** | 研发投入滚动 | 研发费用占营收比 | 创新投入力度 |
| **06** | 利润率结构 | 毛利率、净利率、费用率 | 盈利能力剖析 |
| **07** | EVA与FCF | 经济增加值、自由现金流 | 真实价值创造 |
| **08** | 营运资本结构 | 应收/存货/应付占比 | 营运效率评估 |
| **09** | ROE杜邦分析 | 净利率×周转×杠杆 | ROE驱动因素 |
| **10** | 技术指标 | K线+MA+MACD+RSI+KDJ | 技术面择时 |
| **11** | DCF估值 | 现金流折现内在价值 | 长期价值锚定 |
| **12** | DDM估值 | 股利折现模型 | 高股息股估值 |
| **14** | 股息率走势 | 历史分红、股息率 | 分红稳定性 |
| **15-16** | 费用走势 | 财务/销售费用率 | 成本控制能力 |
| **18** | 财务状况一览 | 三表核心指标汇总 | 财务健康速览 |
| **20** | 运营效率分析 | 周转率、现金周期 | 运营能力对比 |
| **21** | 历史估值通道 | PE/PB历史分位 | 高低估判断 |
| **22** | 行业对标分析 | 同行业TOP4雷达图 | 竞争力定位 |
| **D1** | 基本面Dashboard | 6维综合评分 | 快速体检 |
| **D2** | 估值Dashboard | 估值综合评分 | 估值一览 |
| **D3** | 费用Dashboard | 三费占比仪表 | 费用结构 |
| **99** | 回测结果 | SMA策略收益曲线 | 量化验证 |

> 💡 **提示**：部分图表依赖数据完整性，如公司无分红则不生成DDM估值图

### 🎯 期货综合评分规则

评分区间: **0-100分**，分为5个等级

| 分数区间 | 操作建议 | 信号强度 |
|:--------:|----------|----------|
| 75-100 | **做多** | 强烈看涨信号 |
| 60-74  | **偏多** | 温和看涨 |
| 40-59  | **观望** | 中性震荡 |
| 25-39  | **偏空** | 温和看跌 |
| 0-24   | **做空** | 强烈看跌信号 |

**评分维度 (满分100)**:
- 趋势信号 (40分): MA均线排列、均线斜率
- 动量信号 (30分): MACD金叉/死叉、RSI超买/超卖
- 持仓信号 (20分): 主力席位净持仓方向
- 波动率 (10分): ATR相对历史水平

---

## 💡 使用技巧

### 股票分析最佳实践

1. **业绩拐点捕捉**: 重点关注 `0_增量分析.png`，观察单季度同比/环比拐点
2. **估值安全边际**: 结合 `04_估值分析.png` 和 `21_历史估值通道.png`，寻找历史低位
3. **现金流质量**: `01_营收现金流滚动.png` 中经营现金流/营收比应 > 1
4. **行业竞争力**: `22_行业对标分析.png` 雷达图应优于行业平均
5. **技术择时**: `10_技术指标.png` 配合基本面，避免高位追涨

### 期货分析最佳实践

1. **趋势为王**: 优先看 MA60 方向，配合 MACD 确认
2. **库存季节性**: 对比历史同期库存水位，判断供需格局
3. **基差修复**: 关注期现价差异常扩大/收窄的机会
4. **主力动向**: 席位持仓大幅变化时，跟随聪明钱
5. **波动率择时**: ATR 处于低位时，适合布局趋势单；高位时减少仓位

---

## 📊 技术指标说明

### 股票指标

| 指标 | 计算方式 | 应用场景 |
|------|----------|----------|
| **PE(TTM)** | 市值 / 过去12个月净利润 | 估值水平，<15低估，>30高估 (因行业而异) |
| **PB** | 市值 / 净资产 | 破净 (PB<1) 可能低估或基本面恶化 |
| **PS** | 市值 / 营收 | 适用于亏损公司或高成长企业 |
| **ROE** | 净利润 / 净资产 | >15%优秀，>20%卓越 |
| **经营现金流/营收** | 经营活动现金流 / 营业收入 | >1 代表盈利质量高 |
| **RSI** | 相对强弱指标 | >70超买，<30超卖 |
| **KDJ** | 随机指标 | K线上穿D线金叉，下穿死叉 |

### 期货指标

| 指标 | 计算方式 | 应用场景 |
|------|----------|----------|
| **MACD** | 快慢均线差值 | 金叉做多，死叉做空 |
| **RSI** | 14日相对强弱 | >70超买风险，<30超卖机会 |
| **ATR** | 平均真实波动幅度 | 衡量市场波动率，设置止损参考 |
| **MA60** | 60日移动平均线 | 中期趋势基准线 |
| **基差** | 期货价 - 现货价 | 正基差(升水)，负基差(贴水) |
| **持仓量** | 前20席位净多头 | >0看多，<0看空 |

---

## ❓ 常见问题 FAQ

<details>
<summary><b>Q1: 为什么某些股票无法生成行业对标分析？</b></summary>

**A**: 可能原因：
1. 该股票所属行业分类不明确
2. 同行业可对比公司数量不足4家
3. akshare 行业数据暂未更新

**解决方案**: 手动在 `stock_analysis_v2.py` 中指定对标公司代码
</details>

<details>
<summary><b>Q2: 期货分析支持查看指定合约吗？</b></summary>

**A**: 当前版本仅支持主连合约分析。如需指定合约，可修改 `FuturesAnalyzer` 类中的 `ak.futures_main_sina()` 为 `ak.futures_zh_spot()` 并手动指定合约代码。
</details>

<details>
<summary><b>Q3: 如何加快分析速度？</b></summary>

**A**: 
1. 降低 `config.py` 中的 `KLINE_YEARS` (默认10年改为5年)
2. 增加 `MAX_WORKERS` 并发线程数 (默认8，可尝试16)
3. 如不需要回测，可注释掉 `analyzer.run_backtest()` 行
</details>

<details>
<summary><b>Q4: 估值模型 (DCF/DDM/EVA) 如何调整参数？</b></summary>

**A**: 编辑 `config.py`:
- **DCF**: 调整 `DISCOUNT_RATE`(折现率) 和 `TERMINAL_GROWTH`(永续增长率)
- **DDM**: 调整 `REQUIRED_RETURN`(要求回报率)
- **EVA**: 调整 `WACC`(加权平均资本成本)

建议根据行业特性调整，如高成长行业可提高永续增长率。
</details>

<details>
<summary><b>Q5: 数据获取失败怎么办？</b></summary>

**A**: 
1. 检查网络连接
2. akshare 接口可能限流，等待1-2分钟后重试
3. 更新 akshare 到最新版: `pip install --upgrade akshare`
4. 查看 akshare 官方文档确认接口是否变更
</details>

<details>
<summary><b>Q6: 能否批量分析多只股票？</b></summary>

**A**: 可以使用 Shell 脚本批量运行:
```bash
#!/bin/bash
for code in 600519 000858 000333 002683
do
    python stock_analysis_v2.py $code
    sleep 5  # 避免API限流
done
```
</details>

---

## 🔄 更新日志

### v3.0 (2026-01-07)
- ✨ 新增期货全维分析模块 (趋势/库存/基差/持仓)
- ✨ 统一股票与期货入口，智能识别代码类型
- ✨ 期货支持30+品种，覆盖金属/能源/农产品/黑色系
- 📊 期货综合评分系统 (0-100分多空判断)
- 🎨 期货报告一张图展示5维分析

### v2.1 (2025)
- 📈 完善行业对标分析雷达图
- 🔧 优化财报解读逻辑
- 🐛 修复部分数据缺失时的异常

### v2.0 (2024)
- 🚀 增量分析模块上线
- 💰 新增 DCF/DDM/EVA 三大估值模型
- 📊 Dashboard 仪表盘可视化
- 🤖 集成 backtrader 量化回测

---

## ⚠️ 注意事项

| 问题 | 解决方案 |
|------|----------|
| akshare 接口超时 | 降低 `MAX_WORKERS` 或重试 |
| 回测功能不可用 | 执行 `pip install backtrader` |
| 中文乱码 | 修改 `config.py` 中 `FONT_FAMILY` |
| 数据缺失 | 检查股票代码是否正确、是否已退市 |
| 行业对比无数据 | 检查公司行业分类是否正确 |

---

## 📚 依赖说明

| 库 | 用途 |
|----|------|
| akshare | A股/期货数据源 + 行业对比 |
| pandas / numpy | 数据处理 |
| matplotlib / seaborn | 可视化 |
| backtrader | 量化回测框架 |

---

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发建议

1. Fork 本仓库
2. 创建特性分支: `git checkout -b feature/AmazingFeature`
3. 提交更改: `git commit -m 'Add some AmazingFeature'`
4. 推送分支: `git push origin feature/AmazingFeature`
5. 提交 Pull Request

### 代码规范

- 使用 Python 3.9+ 特性
- 遵循 PEP 8 代码风格
- 添加必要的注释和文档字符串
- 新增功能需包含使用示例

---

## ⚖️ 免责声明

**本工具仅供学习和研究使用，不构成任何投资建议。**

- 所有数据来源于公开数据接口 (akshare)，不保证实时性和准确性
- 分析结果基于历史数据和量化模型，不代表未来表现
- 投资有风险，决策需谨慎，请独立判断并自行承担投资风险
- 作者不对使用本工具造成的任何损失负责

---

## 📧 联系方式

- 问题反馈: 提交 [GitHub Issues](../../issues)
- 功能建议: 提交 [GitHub Discussions](../../discussions)

---

## 📄 License

MIT License

---

## ⭐ Star History

如果这个项目对你有帮助，请给一个 ⭐️ Star 支持一下！
